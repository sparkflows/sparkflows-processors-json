{
  "name": "01-Data-Preparation-Transcript-And-Diarization-New",
  "uuid": "a3c731fa-c82e-4238-bfe1-b4e1d6c46786",
  "category": "Audio Analysis",
  "description": "-",
  "parameters": " --var getStarted=true --var speakers_count=2 --var context=\"the officer is conducting a behavioral analysis\" --var submit1=true --var destinationPath=/home/sparkflows/fire-data/data/GENAI/Law-Enforcement-Audio-Analysis/Upload-Dir/Behavioral_Analysis_GustavoX.m4a --var getStarted=false",
  "nodes": [
    {
      "id": "1",
      "name": "Audio Diarization",
      "iconImage": "fa fa-tumblr-square",
      "description": "This node processes audio files to transcribe and diarize speech, identifying different speakers in the audio. It generates a structured output as a DataFrame with two columns: speaker and dialogue.\n",
      "details": "<h2>Audio Diarization Node Details</h2><br>\nThe Audio Diarization node processes audio files to transcribe speech and, optionally, diarize it by identifying different speakers. It uses OpenAI's Whisper model (or other specified models) to generate a structured DataFrame output with two columns: speaker and dialogue. This node is ideal for extracting and organizing spoken content from audio files in PySpark-based data pipelines.<br>\n<br>\n<h4>General:</h4><br>\n<h5>Directory Or File Path:</h5> Specifies the path to a single audio file or a directory containing multiple audio files. This field is required and must be accessible to the PySpark engine.<br>\n<br>\n<h5>Number of Speakers:</h5> Specifies the expected number of speakers in the audio. Default is 1. If set to 1, diarization is not applied, and all dialogue is attributed to a single speaker. Must be an integer.<br>\n<br>\n<h5>Diarization:</h5> Controls whether speaker diarization is performed. Options are:<br>\n<ul>\n<li> true: Enables diarization to identify and label different speakers in the audio.</li>\n<li> false: Disables diarization, treating all dialogue as coming from a single speaker (default).</li>\n</ul>\n<h5>Output Save Path:</h5> Specifies the file path to save the transcription output as a .txt file. This is optional; if provided, the transcribed text is saved to the specified location.<br>\n<br>\n<h5>Additional Context:</h5> Allows users to provide additional context or details about the conversation (e.g., speaker names, accents, or topics) to improve transcription and diarization accuracy. This is optional.<br>\n<br>\n<h4>OpenAI Configuration:</h4><br>\n<h5>Select Connection:</h5> Specifies the connection details for the OpenAI API (e.g., API key). This is required to authenticate and access the OpenAI model.<br>\n<br>\n<h5>OpenAI Model:</h5> Specifies the OpenAI model to use for transcription. Default is 'whisper-1'. Other compatible models can be specified if supported by the OpenAI API.<br>\n<br>\n<h4>Output:</h4><br>\nThe node outputs a DataFrame with the following columns:<br>\n<ul>\n<li> speaker: The identified speaker label (e.g., Speaker_1, Speaker_2, or 'Default' if diarization is disabled).</li>\n<li> dialogue: The transcribed text corresponding to the speaker's speech.</li>\n</ul>",
      "examples": "<h2>Example: Audio Diarization Node</h2><br>\n<br>\n<h3>Input:</h3><br>\nA directory /data/audio/ contains the following file:<br>\n- meeting_recording.wav (a 5-minute audio file with two speakers discussing a project)<br>\n<br>\nThe Audio Diarization node is configured as follows:<br>\n<ul>\n<li> Directory Or File Path: /data/audio/meeting_recording.wav</li>\n<li> Number of Speakers: 2</li>\n<li> Diarization: true</li>\n<li> Output Save Path: /data/output/transcription.txt</li>\n<li> Additional Context: \"Conversation between a project manager and a developer discussing project milestones.\"</li>\n<li> Select Connection: Configured with a valid OpenAI API key</li>\n<li> OpenAI Model: whisper-1</li>\n</ul>\n<h3>Output:</h3><br>\nThe node processes the audio file and produces a DataFrame with the following structure:<br>\n<br>\nspeaker     | dialogue<br>\n------------|--------------------------------------<br>\nSpeaker_1   | Let's discuss the project timeline...<br>\nSpeaker_2   | Sure, we need to finalize the milestones...<br>\nSpeaker_1   | I think we should prioritize the testing phase...<br>\nSpeaker_2   | Agreed, but we need more resources for that...<br>\n<br>\nThe transcription is also saved as /data/output/transcription.txt with the content:<br>\n<ul>\n<li> Speaker_1: Let's discuss the project timeline...</li>\n<li> Speaker_2: Sure, we need to finalize the milestones...</li>\n<li> Speaker_1: I think we should prioritize the testing phase...</li>\n<li> Speaker_2: Agreed, but we need more resources for that...</li>\n</ul>\n<br>\n<h3>Explanation:</h3><br>\n- The meeting_recording.wav file is processed using the OpenAI Whisper-1 model.<br>\n- With Diarization set to true and Number of Speakers set to 2, the node identifies two distinct speakers and labels them as Speaker_1 and Speaker_2.<br>\n- The dialogue column contains the transcribed text for each speaker's segment.<br>\n- The Additional Context (\"Conversation between a project manager and a developer...\") helps improve the accuracy of transcription and diarization by providing relevant information about the conversation.<br>\n- The transcription is saved as a .txt file in /data/output/transcription.txt as specified in the Output Save Path.<br>\n- If Diarization was set to false or Number of Speakers was set to 1, all dialogue would be attributed to a single speaker labeled 'Default'.<br>",
      "type": "pyspark",
      "nodeClass": "fire.nodes.gai.NodeSpeechToText",
      "x": "136.067px",
      "y": "134.067px",
      "fields": [
        {
          "name": "storageLevel",
          "value": "DEFAULT",
          "widget": "array",
          "title": "Output Storage Level",
          "description": "Storage Level of the Output Datasets of this Node",
          "optionsArray": [
            "DEFAULT",
            "NONE",
            "DISK_ONLY",
            "DISK_ONLY_2",
            "MEMORY_ONLY",
            "MEMORY_ONLY_2",
            "MEMORY_ONLY_SER",
            "MEMORY_ONLY_SER_2",
            "MEMORY_AND_DISK",
            "MEMORY_AND_DISK_2",
            "MEMORY_AND_DISK_SER",
            "MEMORY_AND_DISK_SER_2",
            "OFF_HEAP"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "audioFilePath",
          "value": "${destinationPath}",
          "widget": "textfield",
          "title": "Directory Or File Path",
          "description": "Select a Pdf/Text/Docx File or Directory",
          "required": true,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "numSpeakers",
          "value": "${speakers_count}",
          "widget": "textfield",
          "title": "Number of Speakers",
          "description": "Provide the number of speakers expected in the conversation.",
          "datatypes": [
            "integer"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "diarization",
          "value": "true",
          "widget": "array",
          "title": "Diarization",
          "description": "Diarise the transcription.",
          "optionsArray": [
            "true",
            "false"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "saveOutputPath",
          "value": "${genaiHome}/data/GENAI/Law-Enforcement-Audio-Analysis/Summary/",
          "widget": "textfield",
          "title": "Output Save Path",
          "description": "Specify the file path to save the transcription output as a .txt file.",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "context",
          "value": "${context}",
          "widget": "textarea_small",
          "title": "Additional Context",
          "description": "Add any relevant context or details about the conversation to help improve the diarization.",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "openai",
          "value": "",
          "widget": "tab",
          "title": "OpenAI",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "llmConnection",
          "value": "openai-api-connection",
          "widget": "object_array",
          "title": "Select Connection",
          "description": "Select Connection",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "openaiModel",
          "value": "whisper-1",
          "widget": "textfield",
          "title": "OpenAI Model",
          "description": "OpenAI Model to be Used",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        }
      ],
      "engine": "pyspark"
    },
    {
      "id": "2",
      "name": "Print N Rows",
      "iconImage": "/images/icons/node-icon/print_n_rows.svg",
      "description": "Prints the specified number of records in the DataFrame. It is useful for seeing intermediate output",
      "details": "<h2>Print N Rows Node Details</h2>\n<br>\nThis node is used to print the first N rows from the incoming dataframe.<br>\n<br>\nThe Number of rows that needs to be printed can be configured in the node.<br>\n<br>\n<h4>Input Parameters</h4>\n<ul>\n<li> OUTPUT STORAGE LEVEL : Keep this as DEFAULT.</li>\n<li> TITLE : Enter a short description for the type of information being displayed.</li>\n<li> NUM ROWS TO PRINT : Set an integer value(N) which controls the number of rows to be displayed(Default N=10).</li>\n<li> DISPLAY DATA TYPE : Shows the output dataframe column datatypes by default.</li>\n</ul>\n<h4>Output</h4>\n<ul>\n<li> This node can be used to view, analyze and validate the output of the Dataframe.</li>\n</ul>",
      "examples": "when input 5 in no of rows,it will show first 5 rows of the table as follows<br>\n<br>\nPartID\tSupplierID\tPartName\t<br>\n<br>\nP9271\t  S798\t    Part_D\t<br>\nP523\t  S955\t    Part_K\t<br>\nP3201\t  S332\t    Part_M\t<br>\nP9634\t  S527\t    Part_G\t<br>\nP9345\t  S850\t    Part_M<br>",
      "type": "transform",
      "nodeClass": "fire.nodes.util.NodePrintFirstNRows",
      "x": "306.133px",
      "y": "132.133px",
      "fields": [
        {
          "name": "storageLevel",
          "value": "DEFAULT",
          "widget": "array",
          "title": "Output Storage Level",
          "description": "Storage Level of the Output Datasets of this Node",
          "optionsArray": [
            "DEFAULT",
            "NONE",
            "DISK_ONLY",
            "DISK_ONLY_2",
            "MEMORY_ONLY",
            "MEMORY_ONLY_2",
            "MEMORY_ONLY_SER",
            "MEMORY_ONLY_SER_2",
            "MEMORY_AND_DISK",
            "MEMORY_AND_DISK_2",
            "MEMORY_AND_DISK_SER",
            "MEMORY_AND_DISK_SER_2",
            "OFF_HEAP"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "title",
          "value": "Speaker Conversation",
          "widget": "textfield",
          "title": "Title",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "n",
          "value": "20",
          "widget": "textfield",
          "title": "Num Rows to Print",
          "description": "number of rows to be printed",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "displayDataType",
          "value": "true",
          "widget": "array",
          "title": "Display Data Type",
          "description": "If true display rows DataType",
          "optionsArray": [
            "true",
            "false"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        }
      ],
      "engine": "all"
    },
    {
      "id": "3",
      "name": "Save CSV",
      "iconImage": "/images/icons/node-icon/csv.svg",
      "description": "Saves the DataFrame into the specified location in CSV Format",
      "details": "This node saves incoming Dataframe into the specified location in CSV format.<br>",
      "examples": "path-folder1/folder2/filename<br>\n<br>\nthe file will be saved under the file name at the path provided<br>\nif folder is not present it will be created and save the file<br>\nif the file already exists selection in save mode determines what happens to the file,append-adds the file data to it overwrite-replaces the file altogether<br>",
      "type": "transform",
      "nodeClass": "fire.nodes.save.NodeSaveCSV",
      "x": "257.067px",
      "y": "270.067px",
      "fields": [
        {
          "name": "storageLevel",
          "value": "",
          "widget": "array",
          "title": "Output Storage Level",
          "description": "Storage Level of the Output Datasets of this Node",
          "optionsArray": [
            "DEFAULT",
            "NONE",
            "DISK_ONLY",
            "DISK_ONLY_2",
            "MEMORY_ONLY",
            "MEMORY_ONLY_2",
            "MEMORY_ONLY_SER",
            "MEMORY_ONLY_SER_2",
            "MEMORY_AND_DISK",
            "MEMORY_AND_DISK_2",
            "MEMORY_AND_DISK_SER",
            "MEMORY_AND_DISK_SER_2",
            "OFF_HEAP"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "path",
          "value": "${genaiHome}/data/GENAI/Law-Enforcement-Audio-Analysis/Diarized-Conversation",
          "widget": "textfield",
          "title": "Path",
          "description": "Path where to save the CSV files",
          "required": true,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "saveMode",
          "value": "Overwrite",
          "widget": "array",
          "title": "Save Mode",
          "description": "Whether to Append, Overwrite or Error if the path Exists",
          "optionsArray": [
            "Append",
            "Overwrite",
            "ErrorIfExists",
            "Ignore"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "header",
          "value": "true",
          "widget": "array",
          "title": "Header",
          "description": "Should a Header Row be saved with each File?",
          "optionsArray": [
            "true",
            "false"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "encoding",
          "value": "UTF-8",
          "widget": "textfield",
          "title": "Encoding",
          "description": "Decodes the CSV files by the given encoding type",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "quote",
          "value": "\"",
          "widget": "textfield",
          "title": "Quote",
          "description": "Sets a single character used for escaping quoted values where the separator can be part of the value",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "escape",
          "value": "\\",
          "widget": "textfield",
          "title": "Escape",
          "description": "Sets a single character used for escaping quotes inside an already quoted value.",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "advanced",
          "value": "",
          "widget": "tab",
          "title": "Advanced",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "partitionColNames",
          "value": "[]",
          "widget": "variables",
          "title": "Partition Column Names",
          "description": "Partition Column Names",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "enableDownloadLink",
          "value": "false",
          "widget": "array_single",
          "title": "Enable Download Link",
          "description": "Generate download links for the saved CSV files",
          "optionsArray": [
            "true",
            "false"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        },
        {
          "name": "fileName",
          "value": "",
          "widget": "textfield",
          "wdgtCommon": "enableDownloadLink",
          "title": "File Name To Download",
          "description": "Enter the FileName",
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": "true"
        },
        {
          "name": "saveAsOneFile",
          "value": "false",
          "widget": "array",
          "title": "Save as One File",
          "description": "Save the output as a single CSV file using coalesce",
          "optionsArray": [
            "true",
            "false"
          ],
          "required": false,
          "display": true,
          "editable": true,
          "disableRefresh": false,
          "expandable": false,
          "header": "",
          "size": "100%",
          "toggle": ""
        }
      ],
      "engine": "all"
    }
  ],
  "edges": [
    {
      "source": "1",
      "target": "2",
      "id": 1
    },
    {
      "source": "1",
      "target": "3",
      "id": 2
    }
  ],
  "dataSetDetails": [],
  "engine": "pyspark"
}