{
  "id": "node_time_series_features",
  "name": "Time Series Features",
  "description": "This node computes various time-series related features from a DataFrame containing transactional data.",
  "input": "It takes a DataFrame with user, date, and optionally amount, item, and category columns.",
  "output": "Returns the original DataFrame with new time-series feature columns appended.",
  "type": "pyspark",
  "engine": "pyspark",
  "nodeClass": "fire.nodes.fe.NodeTimeSeriesFeatures",
  "fields": [
    {"name": "userCol", "value": "", "widget": "variable", "title": "User ID Column", "description": "Column representing the user or entity ID.", "required": true, "size": "50%"},
    {"name": "dateCol", "value": "", "widget": "variable", "title": "Date/Timestamp Column", "description": "Column representing the transaction date or timestamp.", "required": true, "size": "50%"},
    {"name": "amountCol", "value": "", "widget": "variable", "title": "Amount Column", "description": "Column representing the transaction amount (optional).", "size": "33%"},
    {"name": "itemCol", "value": "", "widget": "variable", "title": "Item Column", "description": "Column representing the item purchased (optional).", "size": "33%"},
    {"name": "categoryCol", "value": "", "widget": "variable", "title": "Category Column", "description": "Column representing the transaction category (optional).", "size": "34%"},
    {"name": "enable_days_since_last_transaction", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Days Since Last Transaction", "description": "Calculates the time elapsed since the user's last transaction.", "size": "50%"},
    {"name": "days_since_last_transaction_unit", "value": "days", "widget": "array", "optionsArray": ["days", "hours"], "title": "Unit", "description": "Time unit for calculation.", "size": "50%", "wdgtCommon": "enable_days_since_last_transaction", "toggle": "true"},
    {"name": "enable_days_until_next_transaction", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Days Until Next Transaction", "description": "Calculates the time remaining until the user's next transaction.", "size": "50%"},
    {"name": "days_until_next_transaction_unit", "value": "days", "widget": "array", "optionsArray": ["days", "hours"], "title": "Unit", "description": "Time unit for calculation.", "size": "50%", "wdgtCommon": "enable_days_until_next_transaction", "toggle": "true"},
    {"name": "enable_transaction_hour", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Transaction Hour", "description": "Extracts the hour from the transaction timestamp."},
    {"name": "enable_transaction_day_of_week", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Transaction Day of Week", "description": "Extracts the day of the week from the transaction timestamp.", "size": "50%"},
    {"name": "transaction_day_of_week_start", "value": "monday", "widget": "array", "optionsArray": ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"], "title": "Week Start Day", "description": "Select the day to be considered as the start of the week (0).", "size": "50%", "wdgtCommon": "enable_transaction_day_of_week", "toggle": "true"},
    {"name": "enable_transaction_day_of_month", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Transaction Day of Month", "description": "Extracts the day of the month from the transaction timestamp."},
    {"name": "enable_week_of_year", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Week of Year", "description": "Extracts the week of the year from the transaction timestamp."},
    {"name": "enable_is_weekend", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Is Weekend", "description": "Creates a binary flag indicating if the transaction occurred on a weekend."},
    {"name": "enable_is_month_start", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Is Month Start", "description": "Creates a binary flag if the transaction is at the start of the month.", "size": "50%"},
    {"name": "month_start_days", "value": "2", "widget": "textfield", "title": "Start Days", "description": "Number of days from the start of the month to consider.", "size": "50%"},
    {"name": "enable_is_month_end", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Is Month End", "description": "Creates a binary flag if the transaction is at the end of the month.", "size": "50%"},
    {"name": "month_end_days", "value": "28", "widget": "textfield", "title": "End Days", "description": "Day of the month from which to consider the end (e.g., 28 for last 3 days of Feb).", "size": "50%"},
    {"name": "enable_time_since_first_transaction", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Time Since First Transaction", "description": "Calculates the time elapsed since the user's very first transaction.", "size": "50%"},
    {"name": "time_since_first_transaction_unit", "value": "days", "widget": "array", "optionsArray": ["days", "hours"], "title": "Unit", "description": "Time unit for calculation.", "size": "50%", "wdgtCommon": "enable_time_since_first_transaction", "toggle": "true"},

    {"name": "enable_time_of_day_bin", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Time of Day Bin", "description": "Categorizes transactions into 'night', 'morning', 'afternoon', and 'evening'."},
    {"name": "enable_season", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Season", "description": "Assigns a season ('winter', 'spring', 'summer', 'autumn') to each transaction based on the month."},

    {"name": "enable_avg_time_between_txns", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Average Time Between Transactions", "description": "Calculates the average time between a user's transactions.", "size": "50%"},
    {"name": "avg_time_between_txns_unit", "value": "days", "widget": "array", "optionsArray": ["days", "hours"], "title": "Unit", "description": "Time unit for calculation.", "size": "50%", "wdgtCommon": "enable_avg_time_between_txns", "toggle": "true"},

    {"name": "enable_rolling_transaction_count", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Rolling Transaction Count", "description": "Counts the number of transactions in a rolling window.", "size": "50%"},
    {"name": "rolling_transaction_count_window", "value": "30", "widget": "textfield", "title": "Window Size (days)", "description": "Window size for the rolling count.", "size": "50%", "wdgtCommon": "enable_rolling_transaction_count", "toggle": "true"},
    {"name": "enable_rolling_amount_mean", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Rolling Amount Mean (Required field : Amount)", "description": "Computes a rolling average of transaction amounts over a defined window", "size": "50%"},
    {"name": "rolling_amount_mean_window", "value": "7", "widget": "textfield", "title": "Window Size (days)", "description": "Window size for the rolling mean.", "size": "50%", "wdgtCommon": "enable_rolling_amount_mean", "toggle": "true"},

    {"name": "enable_days_since_last_same_item", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Days Since Last Same Item (Required field : Item)", "description": "Calculates time since the last purchase of the same item", "size": "50%"},
    {"name": "days_since_last_same_item_unit", "value": "days", "widget": "array", "optionsArray": ["days", "hours"], "title": "Unit", "description": "Time unit for calculation.", "size": "50%", "wdgtCommon": "enable_days_since_last_same_item", "toggle": "true"},
    {"name": "enable_days_since_last_same_category", "value": "false", "widget": "array_single", "optionsArray": ["true", "false"], "title": "Enable Days Since Last Same Category (Required field : Category)", "description": "Calculates time since the last purchase in the same category.", "size": "50%"},
    {"name": "days_since_last_same_category_unit", "value": "days", "widget": "array", "optionsArray": ["days", "hours"], "title": "Unit", "description": "Time unit for calculation.", "size": "50%", "wdgtCommon": "enable_days_since_last_same_category", "toggle": "true"}
  ]
}

start-details:

h2:Time Series Features Node Details

The Time Series Features node is designed to compute a variety of time-series related features from transactional data stored in a DataFrame. It processes user-level data to generate features such as time since last transaction, transaction hour, day of the week, and more, based on the configured options. These features are appended as new columns to the input DataFrame.

h3:General:

h4:User ID Column:
Specifies the column containing the user or entity identifier (e.g., user_id, customer_id). This is a required field used for partitioning the data for user-level feature calculations.

h4:Date/Timestamp Column:
Specifies the column containing the date or timestamp of the transactions. This is a required field used for all time-based feature computations.

h4:Amount Column:
Specifies an optional column containing the transaction amount (e.g., purchase value). Required for features like rolling amount mean.

h4:Item Column:
Specifies an optional column containing the item purchased in the transaction. Required for computing days since last same item.

h4:Category Column:
Specifies an optional column containing the transaction category. Required for computing days since last same category.

h4:Enable Days Since Last Transaction:
When enabled, calculates the time elapsed since the user's last transaction in the specified time unit (days or hours).

h4:Days Since Last Transaction Unit:
Selects the time unit (days or hours) for the days since last transaction calculation.

h4:Enable Days Until Next Transaction:
When enabled, calculates the time remaining until the user's next transaction in the specified time unit (days or hours).

h4:Days Until Next Transaction Unit:
Selects the time unit (days or hours) for the days until next transaction calculation.

h4:Enable Transaction Hour:
When enabled, extracts the hour of the day (0-23) from the transaction timestamp.

h4:Enable Transaction Day of Week:
When enabled, extracts the day of the week from the transaction timestamp, with the week start day configurable (e.g., Monday as 0).

h4:Week Start Day:
Selects the day considered as the start of the week (0) for day of week calculations (e.g., Monday, Tuesday, etc.).

h4:Enable Transaction Day of Month:
When enabled, extracts the day of the month (1-31) from the transaction timestamp.

h4:Enable Week of Year:
When enabled, extracts the week of the year (1-52) from the transaction timestamp, with Monday as the week start.

h4:Enable Is Weekend:
When enabled, creates a binary flag (1 or 0) indicating whether the transaction occurred on a weekend (typically Saturday and Sunday).

h4:Enable Is Month Start:
When enabled, creates a binary flag (1 or 0) indicating whether the transaction occurred at the start of the month, based on a configurable number of days.

h4:Start Days:
Specifies the number of days from the start of the month to consider as the "month start" (e.g., 2 for the first two days).

h4:Enable Is Month End:
When enabled, creates a binary flag (1 or 0) indicating whether the transaction occurred at the end of the month, based on a configurable day threshold.

h4:End Days:
Specifies the day of the month from which to consider the "month end" (e.g., 28 for the last few days of the month).

h4:Enable Time Since First Transaction:
When enabled, calculates the time elapsed since the user's first recorded transaction in the specified time unit (days or hours).

h4:Time Since First Transaction Unit:
Selects the time unit (days or hours) for the time since first transaction calculation.

h4:Enable Time of Day Bin:
When enabled, categorizes transactions into time-of-day bins: 'night' (0-5), 'morning' (6-11), 'afternoon' (12-17), or 'evening' (18-23).

h4:Enable Season:
When enabled, assigns a season ('winter', 'spring', 'summer', or 'autumn') to each transaction based on the month (e.g., December-February is winter).

h4:Enable Average Time Between Transactions:
When enabled, calculates the average time between a user's consecutive transactions in the specified time unit (days or hours).

h4:Average Time Between Transactions Unit:
Selects the time unit (days or hours) for the average time between transactions calculation.

h4:Enable Rolling Transaction Count:
When enabled, counts the number of transactions within a rolling time window (in days).

h4:Rolling Transaction Count Window:
Specifies the window size (in days) for the rolling transaction count.

h4:Enable Rolling Amount Mean:
When enabled, computes the rolling average of transaction amounts over a specified window (in days). Requires the Amount Column.

h4:Rolling Amount Mean Window:
Specifies the window size (in days) for the rolling amount mean.

h4:Enable Days Since Last Same Item:
When enabled, calculates the time since the last purchase of the same item. Requires the Item Column.

h4:Days Since Last Same Item Unit:
Selects the time unit (days or hours) for the days since last same item calculation.

h4:Enable Days Since Last Same Category:
When enabled, calculates the time since the last purchase in the same category. Requires the Category Column.

h4:Days Since Last Same Category Unit:
Selects the time unit (days or hours) for the days since last same category calculation.

h3:Output:
The node outputs the original DataFrame with additional columns based on the enabled features:
- days_since_last_transaction or hours_since_last_transaction
- days_until_next_transaction or hours_until_next_transaction
- transaction_hour
- transaction_day_of_week
- transaction_day_of_month
- week_of_year
- is_weekend
- is_month_start
- is_month_end
- time_since_first_transaction_days or time_since_first_transaction_hours
- time_of_day_bin
- season
- avg_time_between_txns_days or avg_time_between_txns_hours
- rolling_transaction_count_<window>d
- rolling_amount_mean_<window>d
- days_since_last_same_item or hours_since_last_same_item
- days_since_last_same_category or hours_since_last_same_category

end-details:

start-examples:

h2:Time Series Features Node Examples

h3:Input:
A DataFrame contains the following data:
- userId: ["U1", "U1", "U2", "U2", "U2"]
- eventDate: ["2023-01-01 08:00:00", "2023-01-10 14:00:00", "2023-01-05 22:00:00", "2023-01-15 12:00:00", "2023-01-25 18:00:00"]
- amount: [100.0, 150.0, 200.0, 300.0, 500.0]
- item: ["itemA", "itemB", "itemA", "itemA", "itemB"]
- category: ["cat1", "cat2", "cat1", "cat1", "cat2"]

The Time Series Features node is configured as follows:
- User ID Column: userId
- Date/Timestamp Column: eventDate
- Amount Column: amount
- Item Column: item
- Category Column: category
- Enable Days Since Last Transaction: true
- Days Since Last Transaction Unit: days
- Enable Transaction Hour: true
- Enable Transaction Day of Week: true
- Week Start Day: Monday
- Enable Is Weekend: true
- Enable Time of Day Bin: true
- Enable Season: true
- Enable Rolling Transaction Count: true
- Rolling Transaction Count Window: 30
- Enable Rolling Amount Mean: true
- Rolling Amount Mean Window: 7
- Enable Days Since Last Same Item: true
- Days Since Last Same Item Unit: days
- Enable Days Since Last Same Category: true
- Days Since Last Same Category Unit: days

h3:Output:
The node processes the DataFrame and produces the following result (values are illustrative, assuming today is 2023-02-01):
- userId: "U1", eventDate: "2023-01-01 08:00:00", amount: 100.0, item: "itemA", category: "cat1"
days_since_last_transaction: null
transaction_hour: 8
transaction_day_of_week: 0
is_weekend: 0
time_of_day_bin: "morning"
season: "winter"
rolling_transaction_count_30d: 1
rolling_amount_mean_7d: 100.0
days_since_last_same_item: null
days_since_last_same_category: null
- userId: "U1", eventDate: "2023-01-10 14:00:00", amount: 150.0, item: "itemB", category: "cat2"
days_since_last_transaction: 9
transaction_hour: 14
transaction_day_of_week: 2
is_weekend: 0
time_of_day_bin: "afternoon"
season: "winter"
rolling_transaction_count_30d: 2
rolling_amount_mean_7d: 125.0
days_since_last_same_item: null
days_since_last_same_category: null
- userId: "U2", eventDate: "2023-01-05 22:00:00", amount: 200.0, item: "itemA", category: "cat1"
days_since_last_transaction: null
transaction_hour: 22
transaction_day_of_week: 4
is_weekend: 0
time_of_day_bin: "evening"
season: "winter"
rolling_transaction_count_30d: 1
rolling_amount_mean_7d: 200.0
days_since_last_same_item: null
days_since_last_same_category: null
- userId: "U2", eventDate: "2023-01-15 12:00:00", amount: 300.0, item: "itemA", category: "cat1"
days_since_last_transaction: 10
transaction_hour: 12
transaction_day_of_week: 0
is_weekend: 0
time_of_day_bin: "afternoon"
season: "winter"
rolling_transaction_count_30d: 2
rolling_amount_mean_7d: 250.0
days_since_last_same_item: 10
days_since_last_same_category: 10
- userId: "U2", eventDate: "2023-01-25 18:00:00", amount: 500.0, item: "itemB", category: "cat2"
days_since_last_transaction: 10
transaction_hour: 18
transaction_day_of_week: 3
is_weekend: 0
time_of_day_bin: "evening"
season: "winter"
rolling_transaction_count_30d: 3
rolling_amount_mean_7d: 400.0
days_since_last_same_item: null
days_since_last_same_category: null

end-examples: