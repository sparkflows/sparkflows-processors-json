{
  "id": "6",
  "name": "Snowflake Sensor",
  "description": "This node is used to continuously monitor a condition or data state in Snowflake until it becomes true.",
  "type": "snowflake",
  "nodeClass": "fire.pipelineNodes.SnowflakeSensor",
  "fields" : [
    {"name": "Name", "value":"", "required":true, "widget": "textfield", "title": "Task Name", "description": "Unique name of the task in airflow DAG." },
	{"name": "sql", "value":"","required":true, "widget": "shellcommand", "title": "SQL Query", "description": "Query to check the condition" },
    {"name": "PokeInterval", "value":"","required":true, "widget": "textfield", "title": "Poke Interval", "description": "Poke Interval(In Seconds)" },
    {"name": "Timeout", "value":"","required":true, "widget": "textfield", "title": "Timeout", "description": "Timeout (In Seconds)" },
	{"name": "Mode", "value":"reschedule", "required":true, "widget": "array", "optionsArray": ["reschedule","poke"], "title": "Mode", "description": "Mode to be used (reschedule or poke)" },
    {"name": "python", "value":"","required":true, "widget": "shellcommand", "title": "Success Condition", "description": "Function to evaluate query result. Examples: 'lambda result: bool(result and len(result) > 0)' for any rows, 'lambda result: bool(result and result[0][0] > 0)' for count queries, 'lambda result: result[0][0] == \"COMPLETED\"' for status checks" },
    {"name": "SnowflakeConnectionId", "value":"", "required":true, "widget": "connections", "title": "Select Snowflake Connection", "description": "Select Snowflake Connection" },
    {"name": "trigger_rule", "value":"all_success", "required":true, "widget": "array", "optionsArray": ["all_success","all_failed","all_done","all_skipped","one_failed","one_success","none_failed","none_failed_min_one_success","none_skipped","always"], "title": "Trigger Rule", "description": "Trigger Rule to be used" }
  ]
}
start-details:

h2: Wait for Snowflake Condition

This node is used to continuously monitor a specific condition or data state in Snowflake until it becomes true.
It runs a Snowflake SQL query at defined intervals and checks if the condition is met.
You can use it to verify whether a table is populated, an ETL process has finished, or a required record is available.

The node supports parameters such as SQL Query, Poke Interval, Timeout, Mode, Success Condition, and Snowflake Connection.
These parameters help control how often the check is performed and how success is determined.
Once the condition is met, the workflow automatically moves to the next task.

end-details:
start-examples:

h2: Wait for Snowflake Condition

Check if data is loaded for the current date:
sql = "SELECT COUNT(*) FROM my_database.my_schema.my_table WHERE load_date = CURRENT_DATE();"

Wait until a specific process completes:
sql = "SELECT status FROM my_database.my_schema.etl_status WHERE job_name = 'DAILY_LOAD' AND status = 'SUCCESS';"

If using a custom condition:
Write an SQL query that returns one or more rows when the condition is satisfied.
For example, the query can check if records exist or if a job status is marked as complete.

Example Function to evaluate query result:
for count check: lambda result: bool(result and result[0][0] > 0)
for status check, lambda result: result[0][0] == 'COMPLETED'

end-examples:
